<odoo>
    <data>

        <!-- MaintainReport  tree -->
        <record model="ir.ui.view" id="fleet_manage_maintain_report_view_tree">
            <field name="name">MaintainReport.tree</field>
            <field name="model">fleet_manage_maintain.report</field>
            <field name="arch" type="xml">
                <tree string="MaintainReport Tree">
					<field name="name"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="report_user_id"/>
					<field name="report_date"/>
					<field name="repair_category"/>
					<field name="repair_level"/>
					<field name="is_fault_vehicle"/>
					<field name="state"/>
                </tree>
            </field>
        </record>

		<!-- MaintainReportPrecheck  tree -->
        <record model="ir.ui.view" id="fleet_manage_maintain_precheck_view_tree">
            <field name="name">MaintainReportPrecheck.tree</field>
            <field name="model">fleet_manage_maintain.report</field>
            <field name="arch" type="xml">
                <tree string="MaintainReportPrecheck Tree" create="false">
					<field name="name"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="report_user_id"/>
					<field name="report_date"/>
					<field name="repair_category"/>
					<field name="repair_level"/>
					<field name="is_fault_vehicle"/>
					<field name="state"/>
                </tree>
            </field>
        </record>

		<!-- MaintainRepair  tree -->
        <record model="ir.ui.view" id="fleet_manage_maintain_repair_view_tree">
            <field name="name">MaintainRepair.tree</field>
            <field name="model">fleet_manage_maintain.repair</field>
            <field name="arch" type="xml">
                <tree string="MaintainRepair Tree" create="false">
					<field name="name"/>
					<field name="report_id"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="license_plate"/>
					<field name="repair_category"/>
					<field name="fault_method_code"/>
					<field name="fault_method_id"/>
					<field name="plan_start_time"/>
					<field name="plan_end_time"/>
					<field name="repair_names"/>
					<field name="state"/>
                </tree>
            </field>
        </record>

		<!-- MaintainDelivery  tree -->
        <record model="ir.ui.view" id="fleet_manage_maintain_delivery_view_tree">
            <field name="name">MaintainDelivery.tree</field>
            <field name="model">fleet_manage_maintain.delivery</field>
            <field name="arch" type="xml">
                <tree string="MaintainDelivery Tree" create="false">
					<field name="name"/>
					<field name="report_id"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="license_plate"/>
					<field name="report_user_id"/>
					<field name="state"/>
                </tree>
            </field>
        </record>


		<!-- MaintainInspect  tree -->
        <record model="ir.ui.view" id="fleet_manage_maintain_inspect_view_tree">
            <field name="name">MaintainInspect.tree</field>
            <field name="model">fleet_manage_maintain.repair</field>
            <field name="arch" type="xml">
                <tree string="MaintainInspect Tree" create="false">
					<field name="name"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="license_plate"/>
					<field name="start_inspect_time"/>
					<field name="repair_names"/>
					<field name="fault_method_code"/>
					<field name="fault_method_id"/>
					<field name="inspect_result"/>
					<field name="state"/>
					<field name="inspect_user_id"/>
					<field name="rework_count"/>
                </tree>
            </field>
        </record>


		<!-- MaintainReport form view -->
        <record model="ir.ui.view" id="fleet_manage_report_view_form">
            <field name="name">MaintainReport.form</field>
            <field name="model">fleet_manage_maintain.report</field>
            <field name="arch" type="xml">
                <form string="MaintainReport Form">
                	<header>
						<button name="action_submit_precheck"
								type="object"
                                string="Submit Precheck"
								states="draft"
                                class="oe_highlight"/> <!-- 提交检验-->
                    	<field name="state"  widget="statusbar" statusbar_visible="draft,precheck,repair,done"/>
                	</header>
					<sheet>

						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						 <group col="2">
	                        <group>
								<field name="vehicle_id" />
								<field name="report_user_id" />
								<field name="repair_category" />
	                        </group>
	                        <group>
	                            <field name="vehicle_type" />
								<field name="report_date" />
								<field name="is_fault_vehicle" />
	                        </group>
                   		 </group>
  						 <notebook>
							<page string="Maintain Repair">
                                <field name="repair_ids">
                                    <tree string="Maintain Repair" editable="bottom">
										<field name="name"/>
										<field name="fault_category_id"/>
										<field name="fault_appearance_id"/>
										<field name="state"/>
                                    </tree>
                                </field>
                            </page>

							 <page string="More Information">
                                <group col="2">
									<group>
										<field name="partner_id" />
										<field name="fleet" />
										<field name="create_name" />
										<field name="remark" />
									</group>
									<group>
										<field name="repair_plant" />
										<field name="repair_level" />
										<field name="department" />
									</group>
								 </group>
                            </page>
			            </notebook>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread" options='{"thread_level": 1}'/>
                    </div>
                </form>
            </field>
        </record>


		<!-- MaintainPrecheck form view -->
        <record model="ir.ui.view" id="fleet_manage_precheck_view_form">
            <field name="name">MaintainPrecheck.form</field>
            <field name="model">fleet_manage_maintain.report</field>
            <field name="arch" type="xml">
                <form string="MaintainPrecheck Form" create="false">
                	<header>
						<button name="action_submit_precheck"
								type="object"
                                string="Precheck"
								states="draft"
                                class="oe_highlight"/> <!-- 提交检验-->

						<button name="action_precheck_to_repair"
								type="object"
                                string="Precheck Success And Create The Delivery"
                                states="precheck"
								class="oe_highlight"/>  <!-- 预检通过并创建交接单-->

						<button name="action_precheck_to_draft"
								type="object"
                                string="Reset to draft"
								states="precheck"/>     <!-- 检验退回-->

						<button type="object"
								name="delivery_manage"
								string="Delivery Manage"
								states="repair"
								class="oe_highlight"/>  <!--管理交接单-->

						<button name="action_repair_to_precheck"
								type="object"
                                string="Dispatch to Precheck"
                                states="repair"/> 		<!-- 退回检验-->

                    	<field name="state"  widget="statusbar"  statusbar_visible="draft,precheck,repair,done"/>
                	</header>
					<sheet>
						<div class="oe_button_box" name="button_box" attrs="{'invisible': [('state', '!=', 'repair')]}">
							<button name="return_action_to_open"
									type="object"
									class="oe_stat_button"
									icon="fa-pencil-square-o"
									context="{'xml_id':'fleet_manage_maintain_repair_action'}"
									help="For dispatching fault">
								<field name="dispatch_count" widget="statinfo" string="Dispatch"/>
							</button>
                   	 	</div>

						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						 <group col="2">
	                        <group>
	                        	<field name="vehicle_id" />
								<field name="report_user_id" />
								<field name="repair_category" />
	                        </group>
	                        <group>
	                            <field name="vehicle_type" />
								<field name="report_date" />
								<field name="is_fault_vehicle" />
	                        </group>
                   		 </group>
  						 <notebook>
							 <page string="Maintain Repair">
								<field name="repair_ids" context="{'form_view_ref': 'fleet_manage_maintain.fleet_manage_repair_view_form_action'}">
									<tree string="Maintain Repair">
										<field name="name"/>
										<field name="fault_category_id"/>
										<field name="fault_appearance_id"/>
										<field name="fault_reason_id"/>
										<field name="fault_method_id"/>
										<field name="fault_method_code"/>
										<field name="repair_names"/>
										<field name="state"/>
									</tree>
								</field>
							 </page>
							 <page string="More Information">
                                <group col="2">
									<group>
										<field name="partner_id" />
										<field name="fleet" />
										<field name="create_name" />
										<field name="remark" />
									</group>
									<group>
										<field name="repair_plant" />
										<field name="repair_level" />
										<field name="department" />
									</group>
								 </group>
                            </page>
			            </notebook>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread" options='{"thread_level": 1}'/>
                    </div>
                </form>
            </field>
        </record>

		<!-- MaintainRepair form view -->
        <record model="ir.ui.view" id="fleet_manage_repair_view_form">
            <field name="name">MaintainRepair.form</field>
            <field name="model">fleet_manage_maintain.repair</field>
			<field name="priority">1</field>
            <field name="arch" type="xml">
                <form string="MaintainRepair Form">
                	<header>
						<button name="action_start_repair" type="object"
                                string="Start Repair"
								states="wait_repair"
                                class="oe_highlight"/> <!-- 开工-->

						<button name="action_start_inspect" type="object"
                                string="Start Inspect"
								states="repair"
                                class="oe_highlight"/> <!-- 报检-->

                    	<field name="state"  widget="statusbar" statusbar_visible="wait_repair,repair,inspect,done" />
                	</header>
					<sheet>
						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						 <group col="2">
	                        <group>
	                        	<field name="fault_reason_id" />
								<field name="fault_method_id" />
								<field name="repair_category" />
								<field name="report_id" />
	                        </group>
	                        <group>
	                            <field name="vehicle_id" />
								<field name="license_plate" />
								<field name="vehicle_type" />
								<field name="rework_count" />
	                        </group>
                   		 </group>
  						 <notebook>
							 <page string="MaintainRepair Jobs">
                                <field name="job_ids">
                                    <tree string="MaintainRepair Jobs">
										<field name="sequence"/>
										<field name="fault_method_id"/>
										<field name="user_id"/>
										<field name="plan_start_time"/>
										<field name="plan_end_time"/>
										<field name="real_start_time"/>
										<field name="real_end_time"/>
										<field name="work_time"/>
										<field name="percentage_work"/>
										<field name="my_work"/>
										<field name="real_work"/>
										 <!--<field name="complex_level"/>-->
										 <!--<field name="warranty_deadline"/>-->
										 <!--<field name="remark"/>-->
                                    </tree>
                                </field>
                             </page>

							 <page string="AvailProducts" name="AvailProducts">
                                <field name="available_product_ids">
                                    <tree string="AvailProducts" editable="bottom">
										<field name="product_id"/>
										<field name="product_code"/>
										<field name="max_count"/>
										<field name="change_count"/>
										<field name="onhand_qty"/>
										<field name="virtual_available"/>
										<field name="require_trans"/>
										<field name="vehicle_model" widget="many2many_tags"/>
                                    </tree>
                                </field>
                             </page>
							 <page string="Operation Manual">
								<field name="operation_manual"/>
							 </page>
							 <page string="Inspect Return Records" >
                                <field name="return_record_ids">
                                    <tree string="Inspect Return Records">
										<field name="repair_id"/>
										<field name="repair_names"/>
										<field name="fault_method_id"/>
										<field name="inspect_user_id"/>
										<field name="return_reason"/>
										<field name="inspect_return_time"/>
										<field name="sequence"/>
                                    </tree>
                                </field>
                            </page>
			            </notebook>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread" options='{"thread_level": 1}'/>
                    </div>
                </form>
            </field>
        </record>


		<!-- MaintainRepair form action -->
        <record model="ir.ui.view" id="fleet_manage_repair_view_form_action">
            <field name="name">MaintainRepair.form</field>
            <field name="model">fleet_manage_maintain.repair</field>
			<field name="priority">0</field>
            <field name="arch" type="xml">
                <form string="MaintainRepair Form">
					<sheet>
						<notebook>
							<page string="MaintainRepair Jobs" >
                                <field name="job_ids">
                                    <tree string="MaintainRepair Jobs" create="false" editable="bottom">
										<field name="sequence"/>
										<field name="fault_method_id"/>
										<field name="user_id"/>
										<field name="plan_start_time"/>
										<field name="plan_end_time"/>
										<field name="real_start_time"/>
										<field name="real_end_time"/>
										<field name="work_time"/>
										<field name="percentage_work"/>
										<field name="my_work"/>
										<field name="real_work"/>
                                    </tree>
                                </field>
                            </page>
			            </notebook>

						 <group col="2">
	                        <group>
								<field name="fault_category_id" />
								<field name="fault_appearance_id" />
								<field name="work_time"/>
								<field name="plan_start_time" />
								<field name="plan_end_time" />
								<field name="operation_manual" invisible="1"/>
								<field name="inspect_standard" invisible="1"/>
								<field name="is_important_product" />
								<field name="important_product_id" />
	                        </group>
	                        <group>
	                            <field name="fault_reason_id" />
								<field name="fault_method_id" />
								<field name="fault_method_code" invisible="1"/>
								<field name="materials_control" invisible="1"/>
								<field name="user_id"  />

								<label for="percentage_work"/>
								<div class="o_row">
									<field name="percentage_work"/><span>%</span>
								</div>
	                        </group>
                   		 </group>

						<footer>
							<button name="dispatch"
									type="object"
									string="Dispatch"
									class="oe_edit_only oe_highlight pull-right"/>
                    	</footer>
					</sheet>
                </form>
            </field>
        </record>

		<!-- MaintainDelivery form view -->
        <record model="ir.ui.view" id="fleet_manage_delivery_view_form">
            <field name="name">MaintainDelivery.form</field>
            <field name="model">fleet_manage_maintain.delivery</field>
            <field name="arch" type="xml">
                <form string="MaintainDelivery Form">
                	<header>
						<button name="action_delivery"
								type="object"
                                string="Comfirm Delivery"
								states="draft"
                                class="oe_highlight"/> <!-- 确认交接-->

						<button name="action_return"
								type="object"
                                string="delivery to Return"
								states="delivery"
                                class="oe_highlight"/> <!-- 确认交回-->

						<button name="return_action_to_open"
                            type="object"
                            class="oe_highlight"
                            states="return"
							string="Query Repair Bill"
                            context="{'xml_id':'fleet_manage_maintain_repair_action'}"/>


                    	<field name="state"  widget="statusbar"/>
                	</header>
					<sheet>
						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						 <group col="2">
	                        <group>
	                        	<field name="report_id" />
								<!--<field name="fault_method_id" />-->
								<!--<field name="repair_category" />-->
								<!--<field name="report_id" />-->
	                        </group>
	                        <group>
	                            <field name="vehicle_id" />
								<field name="license_plate" />
								<field name="vehicle_type" />
	                        </group>
                   		 </group>
						<notebook>
							<page string="Other Information">
								<group col="1">
									<group>
										<field name="create_date"/>
										<field name="report_user_id"/>
										<field name="delivery_time"/>
										<field name="delivery_return_time"/>
									</group>
								</group>
                            </page>
						</notebook>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread" options='{"thread_level": 1}'/>
                    </div>
                </form>
            </field>
        </record>


		<!-- MaintainInspect form view -->
        <record model="ir.ui.view" id="fleet_manage_inspect_view_form">
            <field name="name">MaintainInspect.form</field>
            <field name="model">fleet_manage_maintain.repair</field>
			<field name="priority">1</field>
            <field name="arch" type="xml">
                <form string="MaintainInspect Form">
                	<header>
						<!--<button name="action_inspect" type="object"-->
                                <!--string="Inspect"-->
								<!--states="repair"-->
                                <!--class="oe_highlight"/> &lt;!&ndash; 报检&ndash;&gt;-->

						<button name="action_done" type="object"
                                string="Inspect Complete"
								states="inspect"
                                class="oe_highlight"/> <!-- 检验完成-->

						<button name="%(fleet_manage_maintain_inspect_return)d"
								type="action"
                                string="Back To Repair"
								states="inspect"/> <!-- 退回重修-->

						<!--<button name="action_inspect" type="object"-->
                                <!--string="Back To Inspect"-->
								<!--states="done"/> &lt;!&ndash; 退回重检&ndash;&gt;-->

                    	<field name="state"  widget="statusbar"  statusbar_visible="repair,inspect,done" />
                	</header>
					<sheet>
						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						<group col="2">
							<group>
								<field name="fault_reason_id" />
								<field name="fault_method_id" />

							</group>
							<group>
								<field name="vehicle_id" />
								<field name="license_plate" />
								<field name="vehicle_type" />
							</group>
						</group>
						<notebook>
							<page string="Inspect Standard">
								<field name="inspect_standard"/>
                            </page>
							<page string="Inspect Return Records" >
                                <field name="return_record_ids">
                                    <tree string="Inspect Return Records">
										<field name="repair_id"/>
										<field name="repair_names"/>
										<field name="fault_method_id"/>
										<field name="inspect_user_id"/>
										<field name="return_reason"/>
										<field name="inspect_return_time"/>
										<field name="sequence"/>
                                    </tree>
                                </field>
                            </page>
						</notebook>
					</sheet>
                </form>
            </field>
        </record>

        <!-- MaintainReport Action-->
		<record model="ir.actions.act_window" id="fleet_manage_maintain_report_action">
			<field name="name">fleet_manage_maintain_report_action</field>
			<field name="res_model">fleet_manage_maintain.report</field>
			<field name="view_mode">tree,form</field>
			<field name="view_ids" eval="[(5, 0, 0),
				(0, 0, {'view_mode': 'tree', 'view_id': ref('fleet_manage_maintain.fleet_manage_maintain_report_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('fleet_manage_maintain.fleet_manage_report_view_form')})]"/>

		</record>

		<!-- MaintainPrecheck Action-->
		<record model="ir.actions.act_window" id="fleet_manage_maintain_precheck_action">
			<field name="name">fleet_manage_maintain_precheck_action</field>
			<field name="res_model">fleet_manage_maintain.report</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state', 'not in', ['back','draft'])]</field>
			<field name="view_ids" eval="[(5, 0, 0),
				(0, 0, {'view_mode': 'tree', 'view_id': ref('fleet_manage_maintain.fleet_manage_maintain_precheck_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('fleet_manage_maintain.fleet_manage_precheck_view_form')})]"/>
		</record>

		<!-- MaintainRepair Action-->
		<record model="ir.actions.act_window" id="fleet_manage_maintain_repair_action">
			<field name="name">fleet_manage_maintain_repair_action</field>
			<field name="res_model">fleet_manage_maintain.repair</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state', 'in', ['dispatch','wait_repair','repair','inspect','done'])]</field>
			<field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('fleet_manage_maintain.fleet_manage_maintain_repair_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('fleet_manage_maintain.fleet_manage_repair_view_form')})]"/>
		</record>

		<!-- MaintainDelivery Action-->
		<record model="ir.actions.act_window" id="fleet_manage_maintain_delivery_action">
			<field name="name">fleet_manage_maintain_delivery_action</field>
			<field name="res_model">fleet_manage_maintain.delivery</field>
			<field name="view_mode">tree,form</field>
		</record>

		<!-- MaintainInspect Action-->
		<record model="ir.actions.act_window" id="fleet_manage_maintain_inspect_action">
			<field name="name">fleet_manage_maintain_inspect_action</field>
			<field name="res_model">fleet_manage_maintain.repair</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state', 'in', ['repair','inspect','done'])]</field>
			<field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('fleet_manage_maintain.fleet_manage_maintain_inspect_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('fleet_manage_maintain.fleet_manage_inspect_view_form')})]"/>
		</record>

		<!-- MaintainRepair Action-->
		<record model="ir.actions.act_window" id="fleet_manage_maintain_repair_action">
			<field name="name">fleet_manage_maintain_repair_action</field>
			<field name="res_model">fleet_manage_maintain.repair</field>
			<field name="view_mode">tree,form</field>
			<field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('fleet_manage_maintain.fleet_manage_maintain_repair_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('fleet_manage_maintain.fleet_manage_repair_view_form')})]"/>
		</record>



		<record id="fleet_manage_maintain_inspect_action_server" model="ir.actions.server">
            <field name="name">Comfirm Inspect</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_fleet_manage_maintain_repair"/>
            <field name="state">code</field>
            <field name="code">
                if context.get('active_model') == 'fleet_manage_maintain.repair' and context.get('active_ids'):
                    action = env['fleet_manage_maintain.repair'].browse(context['active_ids']).action_done()
            </field>
        </record>

        <record id="action_hr_expense_submit" model="ir.values">
            <field name="name">Comfirm Inspect</field>
            <field name="model_id" ref="model_fleet_manage_maintain_repair"/>
            <field name="model">fleet_manage_maintain.repair</field>
            <field name="key2">client_action_multi</field>
            <field eval="'ir.actions.server,%d'%fleet_manage_maintain_inspect_action_server" name="value"/>
        </record>


		<menuitem name="fleet_manage_maintain"
				  id="fleet_manage_maintain"
				  parent="fleet_manage_menu.fleet_manage_warranty_maintain"/>

        <menuitem name="report_bill"
				  id="fleet_manage_maintain_report_bill"
				  parent="fleet_manage_maintain"
				  action="fleet_manage_maintain_report_action"
				  sequence="1"
				  />
		<menuitem name="precheck_bill"
				  id="fleet_manage_maintain_precheck_bill"
				  parent="fleet_manage_maintain"
				  action="fleet_manage_maintain_precheck_action"
				  sequence="2"
				  />
        <menuitem name="repair_bill"
				  id="fleet_manage_maintain_repair_bill"
				  parent="fleet_manage_maintain"
				  action="fleet_manage_maintain_repair_action"
				  sequence="3"
				  />
        <menuitem name="delivery_bill"
				  id="fleet_manage_maintain_delivery_bill"
				  parent="fleet_manage_maintain"
				  action="fleet_manage_maintain_delivery_action"
				  sequence="4"
				  />
        <menuitem name="inspect_bill"
				  id="fleet_manage_maintain_inspect_bill"
				  parent="fleet_manage_maintain"
				  action="fleet_manage_maintain_inspect_action"
				  sequence="5"
				  />
    </data>
</odoo>