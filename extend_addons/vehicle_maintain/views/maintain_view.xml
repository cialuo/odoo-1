<odoo>
    <data>

        <!-- MaintainReport  tree -->
        <record model="ir.ui.view" id="maintain_report_view_tree">
            <field name="name">MaintainReport.tree</field>
            <field name="model">maintain.manage.report</field>
            <field name="arch" type="xml">
                <tree string="MaintainReport Tree">
					<field name="name"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="report_user_id"/>
					<field name="report_date"/>
					<field name="repair_category"/>
					<field name="repair_level"/>
					<field name="is_fault_vehicle"/>
					<field name="state"/>
                </tree>
            </field>
        </record>

		<!-- MaintainPrecheck  tree -->
        <record model="ir.ui.view" id="maintain_precheck_view_tree">
            <field name="name">MaintainPrecheck.tree</field>
            <field name="model">maintain.manage.report</field>
            <field name="arch" type="xml">
                <tree string="MaintainPrecheck Tree" create="false">
					<field name="name"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="report_user_id"/>
					<field name="report_date"/>
					<field name="repair_category"/>
					<field name="repair_level"/>
					<field name="is_fault_vehicle"/>
					<field name="state"/>
                </tree>
            </field>
        </record>

		<!-- MaintainRepair  tree -->
        <record model="ir.ui.view" id="maintain_repair_view_tree">
            <field name="name">MaintainRepair.tree</field>
            <field name="model">maintain.manage.repair</field>
            <field name="arch" type="xml">
                <tree string="MaintainRepair Tree" create="false">
					<field name="name"/>
					<field name="report_id"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="license_plate"/>
					<field name="repair_category"/>
					<field name="fault_method_code"/>
					<field name="fault_method_id"/>
					<field name="plan_start_time"/>
					<field name="plan_end_time"/>
					<field name="repair_names"/>
					<field name="state"/>
                </tree>
            </field>
        </record>

		<!-- MaintainInspect  tree -->
        <record model="ir.ui.view" id="maintain_inspect_view_tree">
            <field name="name">MaintainInspect.tree</field>
            <field name="model">maintain.manage.repair</field>
            <field name="arch" type="xml">
                <tree string="MaintainInspect Tree" create="false">
					<field name="name"/>
					<field name="vehicle_id"/>
					<field name="vehicle_type"/>
					<field name="license_plate"/>
					<field name="start_inspect_time"/>
					<field name="repair_names"/>
					<field name="fault_method_code"/>
					<field name="fault_method_id"/>
					<field name="inspect_result"/>
					<field name="state"/>
					<field name="inspect_user_id"/>
					<field name="rework_count"/>
                </tree>
            </field>
        </record>


		<!-- MaintainReport form view -->
        <record model="ir.ui.view" id="maintain_report_view_form">
            <field name="name">MaintainReport.form</field>
            <field name="model">maintain.manage.report</field>
            <field name="arch" type="xml">
                <form string="MaintainReport Form">
                	<header>
						<button name="action_submit_precheck"
								type="object"
								string="Submit Precheck"
								states="draft"
								class="oe_highlight"
								groups="vehicle_maintain.maintain_manage_driver,vehicle_maintain.maintain_manage_depot"
								/> <!-- 提交检验-->
                    	<field name="state" widget="statusbar" statusbar_visible="draft,precheck,repair,completed"/>
                	</header>
					<sheet>
						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						 <group col="2">
							 <group>
								<field name="vehicle_id" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_open':True,'no_create':True}"/>
								<field name="report_user_id" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_open':True,'no_create':True}"/>
								<field name="repair_category" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                         </group>
	                         <group>
	                            <field name="vehicle_type" />
								<field name="report_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
								<field name="is_fault_vehicle" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                         </group>
                   		 </group>
  						 <notebook>
							 <page string="Maintain Repair">
                                <field name="repair_ids">
                                    <tree string="Maintain Repair" editable="bottom">
										<field name="name"/>
										<field name="fault_category_id" options="{'no_open':True,'no_create':True}"/>
										<field name="fault_appearance_id" options="{'no_open':True,'no_create':True}" domain="[('category_id', '=', fault_category_id)]"/>
										<field name="state"/>
                                    </tree>
                                </field>
                             </page>

							 <page string="More Information">
                                <group col="2">
									<group>
										<field name="repair_department" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_open':True,'no_create':True}"/>
										<field name="fleet" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
										<field name="create_name" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_open':True,'no_create':True}"/>
										<field name="remark" />
									</group>
									<group>
										<field name="repair_plant" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
										<field name="repair_level" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
										<field name="create_name_department"/>
									</group>
								 </group>
                            </page>
			            </notebook>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread" options='{"thread_level": 1}'/>
                    </div>
                </form>
            </field>
        </record>


		<!-- MaintainPrecheck form view -->
        <record model="ir.ui.view" id="maintain_precheck_view_form">
            <field name="name">MaintainPrecheck.form</field>
            <field name="model">maintain.manage.report</field>
            <field name="arch" type="xml">
                <form string="MaintainPrecheck Form" create="false">
                	<header>
						<!--<button name="action_submit_precheck"-->
								<!--type="object"-->
                                <!--string="Precheck"-->
								<!--states="draft"-->
                                <!--class="oe_highlight"/> &lt;!&ndash; 提交检验&ndash;&gt;-->

						<button name="action_precheck_to_repair"
								type="object"
                                string="Precheck Success"
                                states="precheck"
								groups="vehicle_maintain.maintain_manage_inspect"
								class="oe_highlight"/>  <!-- 预检通过并创建交接单-->

						<button name="action_precheck_to_draft"
								type="object"
                                string="Reset to draft"
								groups="vehicle_maintain.maintain_manage_inspect"
								states="precheck"/>     <!-- 检验退回-->


						<!--<button name="action_repair_to_precheck"-->
								<!--type="object"-->
                                <!--string="Dispatch to Precheck"-->
                                <!--states="repair"/> 		&lt;!&ndash; 退回检验&ndash;&gt;-->

                    	<field name="state"  widget="statusbar"  statusbar_visible="draft,precheck,repair,completed"/>
                	</header>
					<sheet>
						<div class="oe_button_box" name="button_box" attrs="{'invisible': [('state', '!=', 'repair')]}">
							<button name="action_to_open"
									type="object"
									class="oe_stat_button"
									icon="fa-pencil-square-o"
									context="{'xml_id':'maintain_repair_action'}"
									attrs="{'invisible': [('dispatch_count', '=', 0)]}"
									help="For dispatching fault">
								<field name="dispatch_count" widget="statinfo" string="Dispatch"/>
							</button>
                   	 	</div>

						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						 <group col="2">
	                        <group>
	                        	<field name="vehicle_id" readonly="1"/>
								<field name="report_user_id" readonly="1"/>
								<field name="repair_category" readonly="1"/>
	                        </group>
	                        <group>
	                            <field name="vehicle_type" readonly="1"/>
								<field name="report_date" readonly="1"/>
								<field name="is_fault_vehicle" readonly="1"/>
	                        </group>
                   		 </group>
  						 <notebook>
							 <page string="Maintain Repair">
								<field name="repair_ids" context="{'form_view_ref': 'maintain_repair_view_form_action'}">
									<tree string="Maintain Repair">
										<field name="name"/>
										<field name="fault_category_id" options="{'no_open':True,'no_create':True}"/>
										<field name="fault_appearance_id" options="{'no_open':True,'no_create':True}"/>
										<field name="fault_reason_id" options="{'no_open':True,'no_create':True}"/>
										<field name="fault_method_id" options="{'no_open':True,'no_create':True}"/>
										<field name="fault_method_code"/>
										<field name="repair_names"/>
										<field name="state"/>
									</tree>
								</field>
							 </page>
							 <page string="More Information">
                                <group col="2">
									<group>
										<field name="repair_department" readonly="1"/>
										<field name="fleet" readonly="1"/>
										<field name="create_name" />
										<field name="remark"/>
									</group>
									<group>
										<field name="repair_plant" readonly="1"/>
										<field name="repair_level" readonly="1"/>
										<field name="create_name_department"/>
									</group>
								 </group>
                            </page>
			            </notebook>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread" options='{"thread_level": 1}'/>
                    </div>
                </form>
            </field>
        </record>

		<!-- MaintainRepair form view -->
        <record model="ir.ui.view" id="maintain_repair_view_form">
            <field name="name">MaintainRepair.form</field>
            <field name="model">maintain.manage.repair</field>
			<field name="priority">1</field>
            <field name="arch" type="xml">
                <form string="MaintainRepair Form">
                	<header>
						<button name="action_start_repair" type="object"
                                string="Start Repair"
								states="wait_repair"
								groups="vehicle_maintain.maintain_manage_repair"
                                class="oe_highlight"/> <!-- 开工-->

						<button name="action_start_inspect" type="object"
                                string="Start Inspect"
								states="repair"
								groups="vehicle_maintain.maintain_manage_repair"
                                class="oe_highlight"/> <!-- 报检-->

                    	<field name="state"  widget="statusbar" statusbar_visible="wait_repair,repair,inspect,completed" />
                	</header>
					<sheet>
						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						 <group col="2">
	                        <group>
	                        	<field name="fault_reason_id" readonly="1"/>
								<field name="fault_method_id" readonly="1"/>
								<field name="repair_category" />
								<field name="report_id" />
	                        </group>
	                        <group>
	                            <field name="vehicle_id" />
								<field name="license_plate" />
								<field name="vehicle_type" />
								<field name="rework_count" />
	                        </group>
                   		 </group>
  						 <notebook>
							 <page string="MaintainRepair Jobs">
                                <field name="job_ids" readonly="1">
                                    <tree string="MaintainRepair Jobs" create="false" delete="false">
										<field name="sequence"/>
										<field name="fault_method_id"/>
										<field name="user_id"/>
										<field name="plan_start_time"/>
										<field name="plan_end_time"/>
										<field name="real_start_time"/>
										<field name="real_end_time"/>
										<field name="work_time"/>
										<field name="percentage_work"/>
										<field name="my_work"/>
										<field name="real_work"/>
										 <!--<field name="complex_level"/>-->
										 <!--<field name="warranty_deadline"/>-->
										 <!--<field name="remark"/>-->
                                    </tree>
                                </field>
                             </page>

							 <page string="AvailProducts" name="AvailProducts">
                                <field name="available_product_ids" readonly="1">
                                    <tree string="AvailProducts" create="false" delete="false">
										<field name="product_id"/>
										<field name="product_code"/>
										<field name="max_count"/>
										<field name="change_count"/>
										<field name="onhand_qty"/>
										<field name="virtual_available"/>
										<field name="require_trans"/>
										<field name="vehicle_model" widget="many2many_tags"/>
                                    </tree>
                                </field>
                             </page>

							 <page string="ProductLists" name="ProductLists">
                                <field name="picking_ids">
                                    <tree string="ProductLists" create="false" delete="false">
										<field name="picking_type_id"/>
										<field name="name"/>
										<field name="location_id"/>
										<field name="min_date"/>
										<field name="date_done"/>
										<field name="origin"/>
										<field name="state"/>
                                    </tree>
                                </field>
								<center>
									 <button name="create_get_picking"
											 type="object"
											 string="Create Get Picking"
											 states="repair,inspect,completed"
											 groups="vehicle_maintain.maintain_manage_repair"
											 class="oe_highlight">
									 </button>

									 <button name="create_back_picking"
											 type="object"
											 states="repair,inspect,completed"
											 groups="vehicle_maintain.maintain_manage_repair"
											 string="Create Back Picking"/>
								</center>
								  <separator/>
                             </page>

							 <page string="Operation Manual">
								<field name="operation_manual"/>
							 </page>
							 <page string="Inspect Return Records" >
                                <field name="return_record_ids" readonly="1">
                                    <tree string="Inspect Return Records" create="false" delete="false">
										<field name="repair_id"/>
										<field name="repair_names"/>
										<field name="fault_method_id"/>
										<field name="inspect_user_id"/>
										<field name="return_reason"/>
										<field name="inspect_return_time"/>
										<field name="sequence"/>
                                    </tree>
                                </field>
                            </page>
			            </notebook>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread" options='{"thread_level": 1}'/>
                    </div>
                </form>
            </field>
        </record>


		<!-- MaintainRepair form action -->
        <record model="ir.ui.view" id="maintain_repair_view_form_action">
            <field name="name">MaintainRepair.form</field>
            <field name="model">maintain.manage.repair</field>
			<field name="priority">0</field>
            <field name="arch" type="xml">
                <form string="MaintainRepair Form">
					<sheet>
						<notebook groups="vehicle_maintain.maintain_manage_dispatch">
							<page string="MaintainRepair Jobs" >
                                <field name="job_ids">
                                    <tree string="MaintainRepair Jobs" create="false" editable="bottom">
										<field name="sequence" readonly="1"/>
										<field name="fault_method_id" readonly="1"/>
										<field name="user_id" readonly="1"/>
										<field name="plan_start_time" readonly="1"/>
										<field name="plan_end_time" readonly="1"/>
										<field name="real_start_time" readonly="1"/>
										<field name="real_end_time" readonly="1"/>
										<field name="work_time" readonly="1"/>
										<field name="percentage_work"/>
										<field name="my_work" readonly="1"/>
										<field name="real_work" readonly="1"/>
                                    </tree>
                                </field>
                            </page>
			            </notebook>

						 <group col="2">
	                        <group>
								<field name="fault_category_id" options="{'no_open':True,'no_create':True}"/>
								<field name="fault_appearance_id" options="{'no_open':True,'no_create':True}"/>
								<field name="fault_reason_id" options="{'no_open':True,'no_create':True}" domain="[('appearance_id', '=', fault_appearance_id),('category_id', '=', fault_category_id)]"/>
								<field name="fault_method_id" required="1" options="{'no_open':True,'no_create':True}" domain="[('reason_id', '=', fault_reason_id)]"/>
								<field name="work_time" groups="vehicle_maintain.maintain_manage_dispatch"/>
								<field name="operation_manual" invisible="1"/>
								<field name="inspect_standard" invisible="1"/>

	                        </group>
	                        <group class="oe_edit_only" groups="vehicle_maintain.maintain_manage_dispatch">
								<field name="plan_start_time"/>
								<field name="plan_end_time"/>
								<field name="fault_method_code" invisible="1"/>
								<field name="materials_control" invisible="1"/>
								<field name="user_id"  options="{'no_open':True,'no_create':True}"/>
								<label for="percentage_work"/>
								<div class="o_row">
									<field name="percentage_work"/><span>%</span>
								</div>
								<field name="state" invisible="1"/>
	                        </group>
                   		 </group>

						 <button name="dispatch"
								 type="object"
								 string="Dispatch"
								 states="dispatch,wait_repair"
								 groups="vehicle_maintain.maintain_manage_dispatch"
								 class="oe_edit_only oe_highlight oe_right"/>
					</sheet>
                </form>
            </field>
        </record>

		<!-- MaintainInspect form view -->
        <record model="ir.ui.view" id="maintain_inspect_view_form">
            <field name="name">MaintainInspect.form</field>
            <field name="model">maintain.manage.repair</field>
			<field name="priority">1</field>
            <field name="arch" type="xml">
                <form string="MaintainInspect Form">
                	<header>

						<button name="action_completed" type="object"
                                string="Inspect Complete"
								states="inspect"
								groups="vehicle_maintain.maintain_manage_inspect"
                                class="oe_highlight"/> <!-- 检验完成-->

						<button name="%(maintain_inspect_return)d"
								type="action"
                                string="Back To Repair"
								groups="vehicle_maintain.maintain_manage_inspect"
								states="inspect"/> <!-- 退回重修-->

                    	<field name="state"  widget="statusbar"  statusbar_visible="repair,inspect,completed" />
                	</header>
					<sheet>
						<div class="oe_title">
	                        <label for="name"/>
							<h1><field name="name" readonly="1"/></h1>
	                    </div>
						<group col="2">
							<group>
								<field name="fault_reason_id" readonly="1"/>
								<field name="fault_method_id" readonly="1"/>
							</group>
							<group>
								<field name="vehicle_id" />
								<field name="license_plate" />
								<field name="vehicle_type" />
							</group>
						</group>
						<notebook>
							<page string="Inspect Standard">
								<field name="inspect_standard"/>
                            </page>
							<page string="Inspect Return Records" >
                                <field name="return_record_ids" readonly="1">
                                    <tree string="Inspect Return Records" create="false" delete="false">
										<field name="repair_id"/>
										<field name="repair_names"/>
										<field name="fault_method_id"/>
										<field name="inspect_user_id"/>
										<field name="return_reason"/>
										<field name="inspect_return_time"/>
										<field name="sequence"/>
                                    </tree>
                                </field>
                            </page>
						</notebook>
					</sheet>
                </form>
            </field>
        </record>

        <!-- MaintainReport Action-->
		<record model="ir.actions.act_window" id="maintain_report_action">
			<field name="name">maintain_report_action</field>
			<field name="res_model">maintain.manage.report</field>
			<field name="view_mode">tree,form</field>
			<field name="view_ids" eval="[(5, 0, 0),
				(0, 0, {'view_mode': 'tree', 'view_id': ref('maintain_report_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('maintain_report_view_form')})]"/>

		</record>

		<!-- MaintainPrecheck Action-->
		<record model="ir.actions.act_window" id="maintain_precheck_action">
			<field name="name">maintain_precheck_action</field>
			<field name="res_model">maintain.manage.report</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state', 'not in', ['back','draft'])]</field>
			<field name="view_ids" eval="[(5, 0, 0),
				(0, 0, {'view_mode': 'tree', 'view_id': ref('maintain_precheck_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('maintain_precheck_view_form')})]"/>
		</record>

		<!-- MaintainRepair Action-->
		<record model="ir.actions.act_window" id="maintain_repair_action">
			<field name="name">maintain_repair_action</field>
			<field name="res_model">maintain.manage.repair</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state', 'in', ['dispatch','wait_repair','repair','inspect','completed'])]</field>
			<field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('maintain_repair_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('maintain_repair_view_form')})]"/>
		</record>


		<!-- MaintainInspect Action-->
		<record model="ir.actions.act_window" id="maintain_inspect_action">
			<field name="name">maintain_inspect_action</field>
			<field name="res_model">maintain.manage.repair</field>
			<field name="view_mode">tree,form</field>
			<field name="domain">[('state', 'in', ['repair','inspect','completed'])]</field>
			<field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('maintain_inspect_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('maintain_inspect_view_form')})]"/>
		</record>


		<record id="maintain_inspect_action_server" model="ir.actions.server">
            <field name="name">Comfirm Inspect</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="model_maintain_manage_repair"/>
            <field name="state">code</field>
            <field name="code">
                if context.get('active_model') == 'maintain.manage.repair' and context.get('active_ids'):
                    action = env['maintain.manage.repair'].browse(context['active_ids']).action_completed()
            </field>
        </record>

        <record id="maintain_inspect_action_server_submit" model="ir.values">
            <field name="name">Comfirm Inspect</field>
            <field name="model_id" ref="model_maintain_manage_repair"/>
            <field name="model">maintain.manage.repair</field>
            <field name="key2">client_action_multi</field>
            <field eval="'ir.actions.server,%d'%maintain_inspect_action_server" name="value"/>
        </record>

		<!--抢修管理-->
		<menuitem name="maintain_manage" id="maintain_manage"
				  parent="vehicle_manage_menu.warranty_maintain_manage"  sequence="20"/>

		<!--报修单-->
        <menuitem name="maintain_report_order" id="maintain_report_order" parent="maintain_manage"
				  action="maintain_report_action" sequence="10" />

		<!--预检单-->
		<menuitem name="maintain_precheck_order" id="maintain_precheck_order" parent="maintain_manage"
				  action="maintain_precheck_action" sequence="20" />

		<!--抢修单-->
        <menuitem name="maintain_repair_order" id="maintain_repair_order" parent="maintain_manage"
				  action="maintain_repair_action" sequence="30" />

		<!--检验单-->
        <menuitem name="maintain_inspect_order" id="maintain_inspect_order" parent="maintain_manage"
				  action="maintain_inspect_action" sequence="50" />
    </data>
</odoo>